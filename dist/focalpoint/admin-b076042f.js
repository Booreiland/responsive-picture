/*!
 * 
 * ResponsivePics
 * 
 * @author Booreiland
 * @version 1.4.0
 * @link https://responsive.pics
 * @license undefined
 * 
 * Copyright (c) 2021 Booreiland
 * 
 * This software is released under the [MIT License](https://github.com/booreiland/responsive-pics/blob/master/LICENSE)
 */
(window.wpackioresponsivePicsfocalpointJsonp=window.wpackioresponsivePicsfocalpointJsonp||[]).push([[0],[function(t,e,n){n(1),n(3),t.exports=n(2)},function(t,e,n){var a="responsivePicsdist".replace(/[^a-zA-Z0-9_-]/g,"");n.p=window["__wpackIo".concat(a)]},function(t,e,n){},function(t,e,n){"use strict";var a;n.r(e),(a=jQuery)(document).ready((function(){var t,e,n,o,i={x:0,y:0},c=function(a){var i=wp.media.template("attachment-select-focal-point"),c=a.find(".thumbnail"),s=a.find(".details-image");i&&(c.prepend(i),t=a.find(".image-focal"),e=a.find(".image-focal__wrapper"),n=a.find(".image-focal__point"),o=a.find(".image-focal__clickarea"),s.prependTo(e));var f=wp.media.template("attachment-save-focal-point"),u=a.find(".attachment-actions");f&&u.append(f)},s=function(t,e){var n={x:0,y:0};if(!0!==e){var a=i;n.x=t.pageX-a.x,n.y=t.pageY-a.y}!function(t){throw new TypeError('"'+t+'" is read-only')}("clickPosition")},f=function(e,n){s(e,n),t.addClass("is-active"),!0},u=function(e){t.toggleClass("is-hover",e)},r=function(e,i){n.css({left:"".concat(e,"%"),top:"".concat(i,"%"),display:"block"}),o.on("mousedown",(function(t){1===t.which&&f(t,!0).move(t)})),n.on("mousedown",(function(t){1===t.which&&f(t)})).on("mouseenter",(function(){u(!0)})).on("mouseleave",(function(){u(!1)})),a(window).on("mouseup",(function(e){1===e.which&&(!1,t.removeClass("is-active"))})).on("mousemove",(function(t){})).on("resize",(function(){}))},l=function(t){t.id;var e=t.get("compat");if(e.item){var n=a(e.item).find(".compat-field-responsive_pics_focal_point_x input").val(),o=a(e.item).find(".compat-field-responsive_pics_focal_point_y input").val();r(n,o)}},d=wp.media.view.Attachment.Details.TwoColumn;wp.media.view.Attachment.Details.TwoColumn=d.extend({initialize:function(){this.model.on("change:compat",this.change,this)},render:function(){wp.media.view.Attachment.prototype.render.apply(this,arguments);var t=this.model.attributes.type;return"image"===t&&(c(this.$el),l(this.model)),this},change:function(){"image"===this.model.attributes.type&&l(this.model)}})})),function(t,e,n){function a(t,e,n){var a=t;return t<e?a=e:t>n&&(a=n),a}var o="image-focal",i="image-focal__img",c="image-focal__point",s="image-focal__clickarea",f="image-focal__button",u="button-primary",r="button-disabled";t.responsivePics=t.responsivePics||{},t.responsivePics.focalPoint=function(l,d,h){var m,p,v=this;v.$el=t(l),v.el=l,v.$el.data("responsivePics.focalPoint",v),v.init=function(){v.options=t.extend({},t.responsivePics.focalPoint.defaultOptions,h),v.addInterfaceElements(),v.attachment.init(),v.focusInterface.init(),v.saveButton.init(),t(n).on("resize",v.attachment.updateDimensionData)},v.addInterfaceElements=function(){m=t(".".concat(o)),p=t(".".concat(s))},v.attachment={$el:!1,id:!1,width:!1,height:!1,offset:{x:!1,y:!1},focalPoint:{x:50,y:50},init:function(){console.log("init",d),v.attachment.$el=t(".".concat(i)),v.attachment.id=d,v.attachment.getData(),v.attachment.$el.on("load",(function(){v.attachment.updateDimensionData()}))},getData:function(){var e={id:v.attachment.id};t.ajax({type:"POST",url:ajaxurl,data:{action:"get_focal_point",attachment:e},dataType:"json"}).always((function(t){if(!0===t.success&&t.data&&t.data.focal_point)try{if(void 0===t.data.focal_point.x||void 0===t.data.focal_point.y)throw new Error("no coordinates");v.attachment.focalPoint=t.data.focal_point}catch(t){console.log(t)}v.attachment.updateDimensionData(),v.focusInterface.updateStylePosition(),v.focusInterface.$el.css({display:"block"}),v.focusInterface.updateDimensionData(),v.focusInterface.updateStyleBackground()}))},updateDimensionData:function(){var t=v.attachment.$el;v.attachment.width=t.width(),v.attachment.height=t.height(),v.attachment.offset.x=t.offset().left,v.attachment.offset.y=t.offset().top}},v.focusInterface={$el:!1,width:0,height:0,radius:0,offset:{x:0,y:0},position:{x:0,y:0},clickPosition:{x:0,y:0},state:{move:!1,active:!1,hover:!1},init:function(){v.focusInterface.$el=t(".".concat(c)),p.on("mousedown",(function(t){1===t.which&&v.focusInterface.startMove(t,!0).move(t)})),v.focusInterface.$el.on("mousedown",(function(t){1===t.which&&v.focusInterface.startMove(t)})).on("mouseenter",(function(){v.focusInterface.hover(!0)})).on("mouseleave",(function(){v.focusInterface.hover(!1)})),t(e).on("mouseup",(function(t){1===t.which&&(v.focusInterface.state.move=!1,v.focusInterface.state.active=!1,m.removeClass("is-active"))})).on("mousemove",(function(t){v.focusInterface.move(t)})).on("resize",(function(){v.focusInterface.updateDimensionData().updateStyle()}))},startMove:function(t,e){return v.attachment.updateDimensionData(),v.focusInterface.updateDimensionData().updateClickPosition(t,e),v.saveButton.highlight(),m.addClass("is-active"),v.focusInterface.state.move=!0,v.focusInterface.state.active=!0,this},move:function(t){if(!1===v.focusInterface.state.move)return!1;var e={},n=v.attachment.offset,o=v.focusInterface.clickPosition;return e.x=t.pageX-n.x-o.x,e.y=t.pageY-n.y-o.y,e.x=a(e.x,0,v.attachment.width),e.y=a(e.y,0,v.attachment.height),v.attachment.focalPoint={x:e.x/v.attachment.width*100,y:e.y/v.attachment.height*100},v.focusInterface.position=e,v.focusInterface.updateStyle(),this},updateStyle:function(){return v.focusInterface.updateStylePosition(),v.focusInterface.updateStyleBackground(),this},updateStylePosition:function(){return v.focusInterface.$el.css({left:"".concat(v.attachment.focalPoint.x,"%"),top:"".concat(v.attachment.focalPoint.y,"%")}),this},updateStyleBackground:function(){var t=0-(v.focusInterface.position.x-v.focusInterface.radius),e=0-(v.focusInterface.position.y-v.focusInterface.radius);return v.focusInterface.$el.css({backgroundImage:'url("'.concat(v.attachment.$el.attr("src"),'")'),backgroundSize:"".concat(v.attachment.width,"px ").concat(v.attachment.height,"px"),backgroundPosition:"".concat(t,"px ").concat(e,"px ")}),this},updateClickPosition:function(t,e){var n={x:0,y:0};if(!0!==e){var a=v.focusInterface.offset;n.x=t.pageX-a.x,n.y=t.pageY-a.y}return v.focusInterface.clickPosition=n,this},updateDimensionData:function(){v.focusInterface.width=v.focusInterface.$el.width(),v.focusInterface.height=v.focusInterface.$el.height();var t=v.focusInterface.width/2;v.focusInterface.radius=t;var e=v.focusInterface.$el.offset();return v.focusInterface.offset={x:e.left+t,y:e.top+t},v.focusInterface.position={x:v.attachment.focalPoint.x/100*v.attachment.width,y:v.attachment.focalPoint.y/100*v.attachment.height},this},hover:function(t){v.focusInterface.state.hover=t,m.toggleClass("is-hover",t)}},v.saveButton={$el:!1,isSaving:!1,init:function(){v.saveButton.$el=t(".".concat(f)),v.saveButton.$el.on("click",v.sendImageCropDataByAjax)},highlight:function(){v.saveButton.$el.removeClass(r).addClass(u).text(responsivePicsL10n.saveButton)},activate:function(){v.saveButton.$el.removeClass(r).removeClass(u)},disable:function(){v.saveButton.$el.removeClass(u).addClass(r)}},v.sendImageCropDataByAjax=function(){var e={id:v.attachment.id,focal_point:v.attachment.focalPoint};t.ajax({type:"POST",url:ajaxurl,data:{action:"set_focal_point",attachment:e},dataType:"json",beforeSend:function(){return!0!==v.saveButton.isSaving&&(v.saveButton.$el.text(responsivePicsL10n.saving),v.saveButton.disable(),v.saveButton.isSaving=!0,!0)}}).always((function(t){var e=responsivePicsL10n.saved;!0!==t.success&&(v.saveButton.activate(),e=responsivePicsL10n.tryAgain),v.saveButton.$el.text(e),v.saveButton.isSaving=!1}))}},t.responsivePics.focalPoint.defaultOptions={myDefaultValue:""},t.fn.initFocalPoint=function(e){return console.log("initFocalPoint",this,parseInt(e)),this.each((function(){new t.responsivePics.focalPoint(this,parseInt(e)).init()}))},t.responsivePics.focalPoint.initAttachment=function(e){var n=t(".attachment-details, .image-editor");if(n.find(".details-image, .imgedit-crop-wrap img").length&&!t(".image-focal").length)return n.initFocalPoint(e)}}(jQuery,window,document)}],[[0,1]]]);
//# sourceMappingURL=admin-b076042f.js.map