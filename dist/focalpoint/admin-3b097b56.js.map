{"version":3,"sources":["webpack:///./node_modules/@wpackio/entrypoint/lib/index.js","webpack:///./assets/scripts/focalpoint.js"],"names":["path","replace","window","concat","$","Focal","init","attachment","focalPoint","getFocalPoint","console","log","picker","$image","point","$imageFocalPoint","x","y","setEventListeners","on","setFocalPoint","draggable","cursor","drag","dragging","containment","$imageFocalWrapper","compat","get","item","find","val","e","pointYOffset","offsetY","height","pointXOffset","offsetX","width","css","top","left","display","Math","round","pageY","offset","pageX","target","offsetLeft","offsetTop","document","ready","initTemplates","element","selectView","wp","media","template","selectParent","selectImage","prepend","$imageFocal","$imageFocalClickarea","prependTo","saveView","saveParent","append","initFocusInterface","updateFocusInterface","currentTarget","TwoColumn","view","Attachment","Details","extend","initialize","this","model","change","render","prototype","apply","arguments","type","attributes","$el","jQuery"],"mappings":"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","file":"focalpoint/admin-3b097b56.js","sourcesContent":["/* eslint-disable camelcase */ /* eslint-disable babel/camelcase */ /* eslint-disable no-underscore-dangle */ // eslint-disable-next-line no-unused-vars\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\n/* global __webpack_public_path__ */ // eslint-disable-next-line spaced-comment\n///<reference types=\"webpack-env\" />\n// We expect __webpack_public_path__ to be present, thanks to webpack\n// We are not using DOM in the typescript library, so let's just hack our way\n// through window\n// tslint:disable-next-line:no-any\n// We would override __webpack_public_path__ only if __WPACKIO__ webpack plugin is set\nif(__WPACKIO__){var path=(__WPACKIO__.appName+__WPACKIO__.outputPath).replace(/[^a-zA-Z0-9_-]/g,'');// eslint-disable-next-line no-global-assign\n__webpack_public_path__=window[\"__wpackIo\".concat(path)];}","(function($) {\n\t/**\n\t Small plugin to set the focal point of an image\n\t**/\n\tconst Focal = {\n\t\t/**\n\t\t Set variables\n\t\t**/\n\t\tinit: attachment => {\n\t\t\tconst focalPoint = Focal.getFocalPoint(attachment);\n\t\t\tconsole.log(focalPoint);\n\n\t\t\tFocal.picker = $image;\n\t\t\tFocal.point  = $imageFocalPoint;\n\t\t\tFocal.x = focalPoint.x;\n\t\t\tFocal.y = focalPoint.y;\n\t\t\tFocal.setEventListeners();\n\t\t},\n\n\t\t/**\n\t\t Event Listeners\n\t\t**/\n\t\tsetEventListeners: () => {\n\t\t\tFocal.picker.on('click', this.setFocalPoint);\n\t\t\tFocal.point.draggable({\n\t\t\t\tcursor: 'move',\n\t\t\t\tdrag: this.dragging,\n\t\t\t\tcontainment: $imageFocalWrapper\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Get Focal Point from meta fields\n\t\t */\n\t\tgetFocalPoint: attachment => {\n\t\t\tconst compat = attachment.get('compat');\n\n\t\t\tif (compat.item) {\n\t\t\t\tconst focalPointX = $(compat.item).find('.compat-field-responsive_pics_focal_point_x input').val();\n\t\t\t\tconst focalPointY = $(compat.item).find('.compat-field-responsive_pics_focal_point_y input').val();\n\n\t\t\t\treturn {\n\t\t\t\t\tx: focalPointX,\n\t\t\t\t\ty: focalPointY\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn;\n\t\t},\n\n\t\t/**\n\t\t Move the focal point\n\t\t**/\n\t\tsetFocalPoint: e => {\n\t\t\tvar pointYOffset = e.offsetY - Focal.point.height() / 2,\n\t\t\t\tpointXOffset = e.offsetX - Focal.point.width() / 2;\n\n\t\t\tFocal.point.css({\n\t\t\t\ttop: pointYOffset,\n\t\t\t\tleft: pointXOffset,\n\t\t\t\tdisplay: 'block'\n\t\t\t});\n\n\t\t\tFocal.x = Math.round((e.pageY - $(this).offset().top) / Focal.picker.height() * 100);\n\t\t\tFocal.y = Math.round((e.pageX - $(this).offset().left) / Focal.picker.width() * 100);\n\t\t},\n\n\n\t\t/**\n\t\t Move focal point and background position when dragging point\n\t\t**/\n\t\tdragging: e => {\n\t\t\tFocal.x = Math.round(e.target.offsetLeft / Focal.picker.width() * 100);\n\t\t\tFocal.y = Math.round(e.target.offsetTop / Focal.picker.height() * 100);\n\t\t},\n\t};\n\n\t$(document).ready(() => {\n\t\t/**\n\t\t * Init templates\n\t\t */\n\t\tconst initTemplates = element => {\n\t\t\t// Append focal point selector\n\t\t\tvar selectView   = wp.media.template('attachment-select-focal-point');\n\t\t\tvar selectParent = element.find('.thumbnail');\n\t\t\tvar selectImage  = element.find('.details-image');\n\n\t\t\tif (selectView) {\n\t\t\t\tselectParent.prepend(selectView);\n\t\t\t\t// Set image focal elements\n\t\t\t\t$imageFocal          = element.find('.image-focal');\n\t\t\t\t$imageFocalWrapper   = element.find('.image-focal__wrapper');\n\t\t\t\t$imageFocalPoint     = element.find('.image-focal__point');\n\t\t\t\t$imageFocalClickarea = element.find('.image-focal__clickarea');\n\t\t\t\tselectImage.prependTo($imageFocalWrapper);\n\t\t\t\t$image               = $imageFocalWrapper.find('.details-image');\n\t\t\t}\n\n\t\t\t// Append focal point save button\n\t\t\tvar saveView   = wp.media.template('attachment-save-focal-point');\n\t\t\tvar saveParent = element.find('.attachment-actions');\n\t\t\tif (saveView) {\n\t\t\t\tsaveParent.append(saveView);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Init Focus Interface\n\t\t */\n\t\tconst initFocusInterface = attachment => {\n\t\t\t// Add image/window listeners\n\t\t\t$image.on('load', e => updateFocusInterface($(e.currentTarget)));\n\t\t\t$(window).on('resize', () => updateFocusInterface($image));\n\n\t\t\t// Init\n\t\t\tFocal.init(attachment);\n\t\t};\n\n\t\t/**\n\t\t * Extend Attachment view\n\t\t */\n\t\tvar TwoColumn = wp.media.view.Attachment.Details.TwoColumn;\n\t\twp.media.view.Attachment.Details.TwoColumn = TwoColumn.extend({\n\t\t\tinitialize: function() {\n\t\t\t\t// Always make sure that our content is up to date.\n\t\t\t\tthis.model.on('change:compat', this.change, this);\n\t\t\t},\n\t\t\trender: function() {\n\t\t\t\t// Ensure that the main view is rendered.\n\t\t\t\twp.media.view.Attachment.prototype.render.apply(this, arguments);\n\t\t\t\t// Init focal point for images\n\t\t\t\tconst { type } = this.model.attributes;\n\t\t\t\tif (type === 'image') {\n\t\t\t\t\tinitTemplates(this.$el);\n\t\t\t\t\tinitFocusInterface(this.model);\n\t\t\t\t}\n\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tchange: function() {\n\t\t\t\t// Re-init focal point for images\n\t\t\t\tconst { type } = this.model.attributes;\n\t\t\t\tif (type === 'image') {\n\t\t\t\t\tfocalPoint = Focal.getFocalPoint(this.model);\n\t\t\t\t\tFocal.x = focalPoint.x;\n\t\t\t\t\tFocal.y = focalPoint.y;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n})(jQuery);\n"],"sourceRoot":""}