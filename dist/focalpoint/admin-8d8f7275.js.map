{"version":3,"sources":["webpack:///./node_modules/@wpackio/entrypoint/lib/index.js","webpack:///./assets/scripts/focalpoint.js"],"names":["path","replace","window","concat","$","_view","$image","$imageFocalWrapper","$imageFocalPoint","$imageFocalClickarea","$imageFocalSave","Focal","jQuery","init","focalPoint","wrapper","picker","point","positionFocalPoint","setEventListeners","on","setFocalPoint","ui","draggable","cursor","start","startDrag","drag","dragging","stop","stopDrag","containment","position","x","y","css","left","top","e","removeClass","pointYOffset","offsetY","height","pointXOffset","offsetX","width","Number","toFixed","addClass","target","offsetLeft","offsetTop","document","ready","updateFocusInterface","initFocusInterface","attachment","get","preventDefault","set","ajax","url","wp","settings","method","data","action","attributes","done","update","fail","jqXHR","textStatus","console","log","always","saveFocalPoint","renderView","view","model","element","selectView","media","template","selectParent","find","selectImage","prepend","prependTo","saveView","saveParent","append","initTemplates","$el","changeView","type","TwoColumnView","Attachment","Details","TwoColumn","extend","initialize","this","change","render","prototype","apply","arguments","views","detach","fetch","EditImageDetailsView","EditImage","editor","imageEdit","controller","options","back","lastState","setState"],"mappings":"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","file":"focalpoint/admin-8d8f7275.js","sourcesContent":["/* eslint-disable camelcase */ /* eslint-disable babel/camelcase */ /* eslint-disable no-underscore-dangle */ // eslint-disable-next-line no-unused-vars\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\n/* global __webpack_public_path__ */ // eslint-disable-next-line spaced-comment\n///<reference types=\"webpack-env\" />\n// We expect __webpack_public_path__ to be present, thanks to webpack\n// We are not using DOM in the typescript library, so let's just hack our way\n// through window\n// tslint:disable-next-line:no-any\n// We would override __webpack_public_path__ only if __WPACKIO__ webpack plugin is set\nif(__WPACKIO__){var path=(__WPACKIO__.appName+__WPACKIO__.outputPath).replace(/[^a-zA-Z0-9_-]/g,'');// eslint-disable-next-line no-global-assign\n__webpack_public_path__=window[\"__wpackIo\".concat(path)];}","(function($) {\n\t/**\n\t Global variables\n\t**/\n\tlet _view;\n\tlet $image;\n\tlet $imageFocal;\n\tlet $imageFocalWrapper;\n\tlet $imageFocalPoint;\n\tlet $imageFocalClickarea;\n\tlet $imageFocalSave;\n\n\t/**\n\t Focal\n\t**/\n\tconst Focal = {\n\t\t/**\n\t\t Set variables\n\t\t**/\n\t\tinit: focalPoint => {\n\t\t\tFocal.wrapper = $imageFocalWrapper;\n\t\t\tFocal.picker = $imageFocalClickarea;\n\t\t\tFocal.point  = $imageFocalPoint;\n\t\t\tFocal.positionFocalPoint(focalPoint);\n\t\t\tFocal.setEventListeners();\n\t\t},\n\n\t\t/**\n\t\t Event Listeners\n\t\t**/\n\t\tsetEventListeners: () => {\n\t\t\tFocal.picker.on('click', Focal.setFocalPoint);\n\n\t\t\t// Check if jQuery UI Draggable widget is active\n\t\t\tif (typeof($.ui.draggable) === 'function') {\n\t\t\t\tFocal.point.draggable({\n\t\t\t\t\tcursor: 'move',\n\t\t\t\t\tstart: Focal.startDrag,\n\t\t\t\t\tdrag: Focal.dragging,\n\t\t\t\t\tstop: Focal.stopDrag,\n\t\t\t\t\tcontainment: Focal.wrapper\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\tpositionFocalPoint: position => {\n\t\t\tFocal.x = position.x;\n\t\t\tFocal.y = position.y;\n\n\t\t\tFocal.point.css({\n\t\t\t\tleft: `${position.x}%`,\n\t\t\t\ttop: `${position.y}%`\n\t\t\t});\n\t\t},\n\n\t\tsetFocalPoint: e => {\n\t\t\t$imageFocalSave.removeClass('button-disabled');\n\n\t\t\tvar pointYOffset = e.offsetY - Focal.point.height() / 2,\n\t\t\t\tpointXOffset = e.offsetX - Focal.point.width() / 2;\n\n\t\t\t// Convert absolute coordinates to percentages\n\t\t\tFocal.x = Number(pointXOffset / Focal.picker.width() * 100).toFixed(2);\n\t\t\tFocal.y = Number(pointYOffset / Focal.picker.height() * 100).toFixed(2);\n\t\t\tFocal.positionFocalPoint(Focal);\n\t\t},\n\n\t\tstartDrag: e => {\n\t\t\t$('body').addClass('focal-point-dragging');\n\t\t\t$imageFocalSave.removeClass('button-disabled');\n\t\t},\n\n\t\tdragging: e => {\n\t\t\tFocal.x = Number(e.target.offsetLeft / Focal.picker.width() * 100).toFixed(2);\n\t\t\tFocal.y = Number(e.target.offsetTop / Focal.picker.height() * 100).toFixed(2);\n\t\t},\n\n\t\tstopDrag: e => {\n\t\t\t$('body').removeClass('focal-point-dragging');\n\t\t\tFocal.positionFocalPoint(Focal);\n\t\t}\n\t};\n\n\t$(document).ready(() => {\n\t\t/**\n\t\t * Init templates\n\t\t */\n\t\tconst initTemplates = element => {\n\t\t\t// Append focal point selector\n\t\t\tconst selectView   = wp.media.template('attachment-select-focal-point');\n\t\t\tconst selectParent = element.find('.thumbnail');\n\t\t\tconst selectImage  = element.find('.details-image');\n\n\t\t\tif (selectView) {\n\t\t\t\tconsole.log(selectParent, selectImage);\n\t\t\t\tselectParent.prepend(selectView);\n\t\t\t\t// Set image focal elements\n\t\t\t\t$imageFocal          = element.find('.image-focal');\n\t\t\t\t$imageFocalWrapper   = element.find('.image-focal__wrapper');\n\t\t\t\t$imageFocalPoint     = element.find('.image-focal__point');\n\t\t\t\t$imageFocalClickarea = element.find('.image-focal__clickarea');\n\t\t\t\tselectImage.prependTo($imageFocalWrapper);\n\t\t\t\t$image               = $imageFocalWrapper.find('.details-image');\n\t\t\t}\n\n\t\t\t// Append focal point save button\n\t\t\tconst saveView   = wp.media.template('attachment-save-focal-point');\n\t\t\tconst saveParent = element.find('.attachment-actions');\n\t\t\tif (saveView) {\n\t\t\t\tsaveParent.append(saveView);\n\t\t\t\t$imageFocalSave = element.find('button.save-attachment-focal-point');\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Save Focal Point\n\t\t */\n\t\tconst saveFocalPoint = attachment => {\n\t\t\tconst focalPoint = {\n\t\t\t\tx: Focal.x,\n\t\t\t\ty: Focal.y\n\t\t\t};\n\n\t\t\tattachment.set({focalPoint});\n\t\t\t$.ajax({\n\t\t\t\turl: wp?.ajax?.settings?.url,\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdata: {\n\t\t\t\t\taction: 'save_focal_point',\n\t\t\t\t\tattachment: attachment?.attributes\n\t\t\t\t}\n\t\t\t})\n\t\t\t// Update view on succesfull save\n\t\t\t.done(data => {\n\t\t\t\t_view.update();\n\t\t\t})\n\t\t\t.fail((jqXHR, textStatus) => {\n\t\t\t\tconsole.log('save focal point error', jqXHR);\n\t\t\t})\n\t\t\t.always(() => {\n\t\t\t\t$imageFocalSave.addClass('button-disabled');\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Update Focus Interface\n\t\t */\n\t\tconst updateFocusInterface = () => {\n\t\t\t$imageFocalWrapper.css({\n\t\t\t\twidth: `${$image.width()}px`\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Init Focus Interface\n\t\t */\n\t\tconst initFocusInterface = attachment => {\n\t\t\tconst focalPoint = attachment.get('focalPoint');\n\n\t\t\t// Interface\n\t\t\t$(window).on('resize', updateFocusInterface);\n\t\t\t$image.on('load', e => {\n\t\t\t\tupdateFocusInterface();\n\t\t\t\tFocal.init(focalPoint);\n\t\t\t});\n\n\t\t\t// Save button\n\t\t\t$imageFocalSave.on('click', e => {\n\t\t\t\te.preventDefault();\n\t\t\t\tsaveFocalPoint(attachment);\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Extended view render\n\t\t */\n\t\tconst renderView = view => {\n\t\t\tconsole.log('renderView', view);\n\t\t\tconst type = view.model.get('type');\n\n\t\t\tif (type === 'image') {\n\t\t\t\tinitTemplates(view.$el);\n\t\t\t\tinitFocusInterface(view.model);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Extended view changed\n\t\t */\n\t\tconst changeView = view => {\n\t\t\tconsole.log('changeView', view);\n\t\t\tconst type       = view.model.get('type');\n\t\t\tconst focalPoint = view.model.get('focalPoint');\n\n\t\t\tif (type === 'image') {\n\t\t\t\tFocal.positionFocalPoint(focalPoint);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Extend TwoColumn view\n\t\t */\n\t\tconst TwoColumnView = wp.media.view.Attachment.Details.TwoColumn;\n\t\tif (TwoColumnView) {\n\t\t\twp.media.view.Attachment.Details.TwoColumn = TwoColumnView.extend({\n\t\t\t\t// Add focalPoint change listener\n\t\t\t\tinitialize: function() {\n\t\t\t\t\t_view = this;\n\t\t\t\t\tthis.model.on('change:focalPoint', this.change, this);\n\n\t\t\t\t\treturn this;\n\t\t\t\t},\n\t\t\t\t// Init extended template\n\t\t\t\trender: function() {\n\t\t\t\t\twp.media.view.Attachment.prototype.render.apply(this, arguments);\n\t\t\t\t\trenderView(this);\n\n\t\t\t\t\treturn this;\n\t\t\t\t},\n\t\t\t\t// Re-init focal point on input change\n\t\t\t\tchange: function() {\n\t\t\t\t\tchangeView(this);\n\n\t\t\t\t\treturn this;\n\t\t\t\t},\n\t\t\t\t// Update view on focal point js change\n\t\t\t\tupdate: function() {\n\t\t\t\t\tthis.views.detach();\n\t\t\t\t\tthis.model.fetch();\n\t\t\t\t\tthis.views.render();\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Extend EditImage view\n\t\t */\n\t\tconst EditImageDetailsView = wp.media.view.EditImage.Details;\n\t\tif (EditImageDetailsView) {\n\t\t\twp.media.view.EditImage.Details = EditImageDetailsView.extend({\n\t\t\t\t// Add focalPoint change listener\n\t\t\t\tinitialize: function() {\n\t\t\t\t\tconsole.log('EditImage Details initialize');\n\t\t\t\t\t_view = this;\n\t\t\t\t\twp.media.view.EditImage.prototype.initialize.apply(this, arguments);\n\t\t\t\t\tthis.editor = window.imageEdit;\n\t\t\t\t\tthis.controller = options.controller;\n\t\t\t\t\tthis.model.on('change:focalPoint', this.change, this);\n\n\t\t\t\t\treturn this;\n\t\t\t\t},\n\t\t\t\t// Init extended template\n\t\t\t\trender: function() {\n\t\t\t\t\tconsole.log('EditImage Details render');\n\t\t\t\t\twp.media.view.EditImage.prototype.render.apply(this, arguments);\n\t\t\t\t\trenderView(this);\n\n\t\t\t\t\treturn this;\n\t\t\t\t},\n\t\t\t\t// Cancel view\n\t\t\t\tback: function() {\n\t\t\t\t\tconsole.log('EditImage Details back');\n\t\t\t\t\tvar lastState = this.controller.lastState();\n\t\t\t\t\tthis.controller.setState(lastState);\n\n\t\t\t\t\treturn this;\n\t\t\t\t},\n\t\t\t\t// Re-init focal point on input change\n\t\t\t\tchange: function() {\n\t\t\t\t\tchangeView(this);\n\n\t\t\t\t\treturn this;\n\t\t\t\t},\n\t\t\t\t// Update view on focal point js change\n\t\t\t\tupdate: function() {\n\t\t\t\t\tthis.views.detach();\n\t\t\t\t\tthis.model.fetch();\n\t\t\t\t\tthis.views.render();\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n})(jQuery);\n"],"sourceRoot":""}