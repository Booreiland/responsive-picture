{"version":3,"sources":["webpack:///./node_modules/@wpackio/entrypoint/lib/index.js","webpack:///./assets/scripts/modules/focal-point-picker.js","webpack:///./assets/scripts/focal-point-admin.js"],"names":["path","replace","window","concat","FocalPointPicker","init","view","position","model","get","wrapper","$el","find","point","picker","image","setEventListeners","positionFocalPoint","jQuery","on","updateInterface","e","setFocalPoint","ui","draggable","cursor","start","startDrag","drag","dragging","stop","stopDrag","containment","css","width","set","left","x","top","y","pointYOffset","offsetY","height","pointXOffset","offsetX","Math","round","saveFocalPoint","attachment","ajax","url","wp","settings","method","data","action","attributes","done","update","fail","jqXHR","textStatus","console","log","always","controller","addClass","target","offsetLeft","offsetTop","removeClass","document","ready","initAttachmentDetails","element","mediaView","media","template","mediaParent","mediaImage","length","prepend","mediaWrapper","prependTo","Attachment","AttachmentDetails","Details","TwoColumnView","TwoColumn","extend","initialize","this","change","render","prototype","apply","arguments","type","focalPoint","views","detach","fetch","updateAll"],"mappings":"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","file":"focalpoint/admin-9e12a185.js","sourcesContent":["/* eslint-disable camelcase */ /* eslint-disable babel/camelcase */ /* eslint-disable no-underscore-dangle */ // eslint-disable-next-line no-unused-vars\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\n/* global __webpack_public_path__ */ // eslint-disable-next-line spaced-comment\n///<reference types=\"webpack-env\" />\n// We expect __webpack_public_path__ to be present, thanks to webpack\n// We are not using DOM in the typescript library, so let's just hack our way\n// through window\n// tslint:disable-next-line:no-any\n// We would override __webpack_public_path__ only if __WPACKIO__ webpack plugin is set\nif(__WPACKIO__){var path=(__WPACKIO__.appName+__WPACKIO__.outputPath).replace(/[^a-zA-Z0-9_-]/g,'');// eslint-disable-next-line no-global-assign\n__webpack_public_path__=window[\"__wpackIo\".concat(path)];}","/**\n * Focal Point Picker module\n */\nconst FocalPointPicker = {\n\tinit: view => {\n\t\t// Set properties\n\t\tFocalPointPicker.view     = view;\n\t\tFocalPointPicker.position = view.model.get('focalPoint');\n\t\tFocalPointPicker.wrapper  = view.$el.find('.image-focal__wrapper');\n\t\tFocalPointPicker.point    = view.$el.find('.image-focal__point');\n\t\tFocalPointPicker.picker   = view.$el.find('.image-focal__clickarea');\n\t\tFocalPointPicker.image    = FocalPointPicker.wrapper.find('img');\n\t\t// Add event listners\n\t\tFocalPointPicker.setEventListeners();\n\t\tFocalPointPicker.positionFocalPoint(FocalPointPicker.position);\n\t},\n\tsetEventListeners: () => {\n\t\t// On layout change\n\t\tjQuery(window).on('resize', FocalPointPicker.updateInterface);\n\t\tFocalPointPicker.image.on('load', e => {\n\t\t\tFocalPointPicker.updateInterface();\n\t\t});\n\n\t\t// On click\n\t\tFocalPointPicker.picker.on('click', FocalPointPicker.setFocalPoint);\n\n\t\t// On drag\n\t\tif (typeof(jQuery.ui.draggable) === 'function') {\n\t\t\tFocalPointPicker.point.draggable({\n\t\t\t\tcursor: 'move',\n\t\t\t\tstart: FocalPointPicker.startDrag,\n\t\t\t\tdrag: FocalPointPicker.dragging,\n\t\t\t\tstop: FocalPointPicker.stopDrag,\n\t\t\t\tcontainment: FocalPointPicker.wrapper\n\t\t\t});\n\t\t}\n\t},\n\tupdateInterface: () => {\n\t\tFocalPointPicker.wrapper.css({\n\t\t\twidth: `${FocalPointPicker.image.width()}px`\n\t\t});\n\t},\n\tpositionFocalPoint: position => {\n\t\tFocalPointPicker.view.model.set('focalPoint', position);\n\t\tFocalPointPicker.point.css({\n\t\t\tleft: `${position.x}%`,\n\t\t\ttop: `${position.y}%`,\n\t\t\tposition: 'absolute'\n\t\t});\n\t},\n\tsetFocalPoint: e => {\n\t\tconst pointYOffset = e.offsetY - FocalPointPicker.point.height() / 2;\n\t\tconst pointXOffset = e.offsetX - FocalPointPicker.point.width() / 2;\n\n\t\t// Convert absolute coordinates to percentages\n\t\tFocalPointPicker.position.x = Math.round(pointXOffset / FocalPointPicker.picker.width() * 100);\n\t\tFocalPointPicker.position.y = Math.round(pointYOffset / FocalPointPicker.picker.height() * 100);\n\n\t\tFocalPointPicker.positionFocalPoint(FocalPointPicker.position);\n\t\tFocalPointPicker.saveFocalPoint(FocalPointPicker.view.model);\n\t},\n\tsaveFocalPoint: attachment => {\n\t\tjQuery.ajax({\n\t\t\turl: wp?.ajax?.settings?.url,\n\t\t\tmethod: 'POST',\n\t\t\tdata: {\n\t\t\t\taction: 'save_focal_point',\n\t\t\t\tattachment: attachment?.attributes\n\t\t\t}\n\t\t})\n\t\t.done(data => {\n\t\t\tFocalPointPicker.view.update();\n\t\t})\n\t\t.fail((jqXHR, textStatus) => {\n\t\t\tconsole.log('save focal point error', jqXHR);\n\t\t})\n\t\t.always(() => {\n\t\t\tconsole.log(FocalPointPicker.view.controller);\n\t\t\t// FocalPointPicker.view.controller.setState('edit-image');\n\t\t});\n\t},\n\tstartDrag: e => {\n\t\tjQuery('body').addClass('focal-point-dragging');\n\t},\n\tdragging: e => {\n\t\tFocalPointPicker.position.x = Math.round(e.target.offsetLeft / FocalPointPicker.picker.width() * 100);\n\t\tFocalPointPicker.position.y = Math.round(e.target.offsetTop / FocalPointPicker.picker.height() * 100);\n\t},\n\tstopDrag: e => {\n\t\tjQuery('body').removeClass('focal-point-dragging');\n\t\tFocalPointPicker.positionFocalPoint(FocalPointPicker.position);\n\t\tFocalPointPicker.saveFocalPoint(FocalPointPicker.view.model);\n\t}\n};\n\nexport default FocalPointPicker;","import FocalPointPicker from './modules/focal-point-picker';\n\n(function($) {\n\n\t$(document).ready(() => {\n\t\t/**\n\t\t * Attachment Details\n\t\t */\n\t\tconst initAttachmentDetails = element => {\n\t\t\t// Append focal point selector\n\t\t\tconst mediaView   = wp.media.template('attachment-details-focal-point');\n\t\t\tconst mediaParent = element.find('.thumbnail');\n\t\t\tconst mediaImage  = mediaParent.find('img');\n\n\t\t\t// Set image focal elements\n\t\t\tif (mediaView && mediaParent.length && mediaImage.length) {\n\t\t\t\tmediaParent.prepend(mediaView);\n\t\t\t\tconst mediaWrapper = mediaParent.find('.image-focal__wrapper');\n\t\t\t\tmediaImage.prependTo(mediaWrapper);\n\t\t\t}\n\t\t};\n\n\t\tconst Attachment = wp.media.view.Attachment;\n\t\tconst AttachmentDetails = wp.media.view.Attachment.Details;\n\t\tconst TwoColumnView = wp.media.view.Attachment.Details.TwoColumn;\n\n\t\t/**\n\t\t * Extend Attachment Details TwoColumn view (Media Library Modal)\n\t\t */\n\t\tif (TwoColumnView) {\n\t\t\twp.media.view.Attachment.Details.TwoColumn = TwoColumnView.extend({\n\t\t\t\t// Add focalPoint change listener\n\t\t\t\tinitialize: function() {\n\t\t\t\t\tthis.model.on('change:focalPoint', this.change, this);\n\t\t\t\t},\n\t\t\t\t// Init extended template\n\t\t\t\trender: function() {\n\t\t\t\t\tAttachment.prototype.render.apply(this, arguments);\n\t\t\t\t\tconst type = this.model.get('type');\n\n\t\t\t\t\tif (type === 'image') {\n\t\t\t\t\t\tinitAttachmentDetails(this.$el);\n\t\t\t\t\t\tFocalPointPicker.init(this);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t// Re-init focal point on input change\n\t\t\t\tchange: function() {\n\t\t\t\t\tconst type = this.model.get('type');\n\t\t\t\t\tconst focalPoint = this.model.get('focalPoint');\n\n\t\t\t\t\tif (type === 'image') {\n\t\t\t\t\t\tFocalPointPicker.positionFocalPoint(focalPoint);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t// Update view on focal point js change\n\t\t\t\tupdate: function() {\n\t\t\t\t\tthis.views.detach();\n\t\t\t\t\tthis.model.fetch();\n\t\t\t\t\tthis.views.render();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Extend Attachment Details view (Post Edit Modal)\n\t\t */\n\t\tif (AttachmentDetails) {\n\t\t\twp.media.view.Attachment.Details = AttachmentDetails.extend({\n\t\t\t\t// Add focalPoint change listener\n\t\t\t\tinitialize: function() {\n\t\t\t\t\tAttachment.prototype.initialize.apply(this, arguments);\n\t\t\t\t\tthis.model.on('change:focalPoint', this.change, this);\n\t\t\t\t},\n\t\t\t\t// Init extended template\n\t\t\t\trender: function() {\n\t\t\t\t\tAttachment.prototype.render.apply(this, arguments);\n\t\t\t\t\tconst id   = this.model.get('id');\n\t\t\t\t\tconst type = this.model.get('type');\n\n\t\t\t\t\tif (type === 'image') {\n\t\t\t\t\t\tinitAttachmentDetails(this.$el);\n\t\t\t\t\t\tFocalPointPicker.init(this);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t// Re-init focal point on input change\n\t\t\t\tchange: function() {\n\t\t\t\t\tconst type = this.model.get('type');\n\t\t\t\t\tconst focalPoint = this.model.get('focalPoint');\n\n\t\t\t\t\tif (type === 'image') {\n\t\t\t\t\t\tFocalPointPicker.positionFocalPoint(focalPoint);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t// Update view on focal point js change\n\t\t\t\tupdate: function() {\n\t\t\t\t\tconsole.log('AttachmentDetails update', this.model);\n\t\t\t\t\tthis.views.detach();\n\t\t\t\t\tthis.model.fetch();\n\t\t\t\t\tthis.views.render();\n\t\t\t\t},\n\t\t\t\t// On update image\n\t\t\t\tupdateAll: function() {\n\t\t\t\t\tconsole.log('AttachmentDetails updateAll', this.model);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n})(jQuery);\n"],"sourceRoot":""}