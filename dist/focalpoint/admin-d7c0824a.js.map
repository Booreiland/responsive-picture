{"version":3,"sources":["webpack:///./node_modules/@wpackio/entrypoint/lib/index.js","webpack:///./assets/scripts/focalpoint.js"],"names":["path","replace","window","concat","$","jQuery","document","ready","$image","$imageFocalWrapper","$imageFocalPoint","isDown","focalPointOffset","x","y","imageDimensions","width","height","initTemplates","element","selectView","wp","media","template","selectParent","find","selectImage","prepend","prependTo","saveView","saveParent","append","getFocalPoint","attachment","compat","get","item","val","setFocalPoint","console","log","css","left","top","display","startDragFocalPoint","e","addClass","offset","currentTarget","pageX","pageY","dragFocalPoint","preventDefault","focalPointPosition","focalPoint","position","Number","toFixed","endDragFocalPoint","removeClass","updateFocusInterface","image","initFocusInterface","on","TwoColumn","view","Attachment","Details","extend","initialize","this","model","change","render","prototype","apply","arguments","type","attributes","$el"],"mappings":"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","file":"focalpoint/admin-d7c0824a.js","sourcesContent":["/* eslint-disable camelcase */ /* eslint-disable babel/camelcase */ /* eslint-disable no-underscore-dangle */ // eslint-disable-next-line no-unused-vars\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\n/* global __webpack_public_path__ */ // eslint-disable-next-line spaced-comment\n///<reference types=\"webpack-env\" />\n// We expect __webpack_public_path__ to be present, thanks to webpack\n// We are not using DOM in the typescript library, so let's just hack our way\n// through window\n// tslint:disable-next-line:no-any\n// We would override __webpack_public_path__ only if __WPACKIO__ webpack plugin is set\nif(__WPACKIO__){var path=(__WPACKIO__.appName+__WPACKIO__.outputPath).replace(/[^a-zA-Z0-9_-]/g,'');// eslint-disable-next-line no-global-assign\n__webpack_public_path__=window[\"__wpackIo\".concat(path)];}","(function($) {\n\t$(document).ready(() => {\n\t\t/**\n\t\t * Set variables\n\t\t */\n\t\tlet $image;\n\t\tlet $imageFocal;\n\t\tlet $imageFocalWrapper;\n\t\tlet $imageFocalPoint;\n\t\tlet $imageFocalClickarea;\n\n\t\tlet isDown = false;\n\t\tlet focalPointOffset = {\n\t\t\tx: 0,\n\t\t\ty: 0\n\t\t};\n\n\t\tlet imageDimensions = {\n\t\t\twidth: 0,\n\t\t\theight: 0\n\t\t};\n\n\t\t/**\n\t\t * Init templates\n\t\t */\n\t\tconst initTemplates = element => {\n\t\t\t// Append focal point selector\n\t\t\tvar selectView   = wp.media.template('attachment-select-focal-point');\n\t\t\tvar selectParent = element.find('.thumbnail');\n\t\t\tvar selectImage  = element.find('.details-image');\n\n\t\t\tif (selectView) {\n\t\t\t\tselectParent.prepend(selectView);\n\t\t\t\t// Set image focal elements\n\t\t\t\t$imageFocal          = element.find('.image-focal');\n\t\t\t\t$imageFocalWrapper   = element.find('.image-focal__wrapper');\n\t\t\t\t$imageFocalPoint     = element.find('.image-focal__point');\n\t\t\t\t$imageFocalClickarea = element.find('.image-focal__clickarea');\n\t\t\t\tselectImage.prependTo($imageFocalWrapper);\n\t\t\t\t$image               = $imageFocalWrapper.find('.details-image');\n\t\t\t}\n\n\t\t\t// Append focal point save button\n\t\t\tvar saveView   = wp.media.template('attachment-save-focal-point');\n\t\t\tvar saveParent = element.find('.attachment-actions');\n\t\t\tif (saveView) {\n\t\t\t\tsaveParent.append(saveView);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Get Focal Point from meta fields\n\t\t */\n\t\tconst getFocalPoint = attachment => {\n\t\t\tconst compat = attachment.get('compat');\n\n\t\t\tif (compat.item) {\n\t\t\t\tconst focalPointX = $(compat.item).find('.compat-field-responsive_pics_focal_point_x input').val();\n\t\t\t\tconst focalPointY = $(compat.item).find('.compat-field-responsive_pics_focal_point_y input').val();\n\n\t\t\t\treturn {\n\t\t\t\t\tx: focalPointX,\n\t\t\t\t\ty: focalPointY\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn;\n\t\t};\n\n\t\t/**\n\t\t * Calculate Focal Point by relative coordinates\n\t\t */\n\t\tconst calculateFocalPoint = position => {\n\t\t\tconsole.log(position);\n\t\t\treturn {\n\t\t\t\tx: Number((position.x / imageDimensions.width) * 100).toFixed(2),\n\t\t\t\ty: Number((position.y / imageDimensions.height) * 100).toFixed(2)\n\t\t\t};\n\t\t};\n\n\t\t/**\n\t\t * Update Focal Point coordinates\n\t\t */\n\t\tconst setFocalPoint = (x, y) => {\n\t\t\tconsole.log('setFocalPoint', x, y);\n\t\t\t$imageFocalPoint.css({\n\t\t\t\tleft: `${x}%`,\n\t\t\t\ttop: `${y}%`,\n\t\t\t\tdisplay: 'block'\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * HTML5 Drag events\n\t\t */\n\t\tconst startDragFocalPoint = e => {\n\t\t\tisDown = true;\n\t\t\t$('body').addClass('focal-point-dragging');\n\t\t\tconst offset = $(e.currentTarget).offset();\n\t\t\tconsole.log(offset);\n\n\t\t\tfocalPointOffset = {\n\t\t\t\tx: offset.left - e.pageX,\n\t\t\t\ty: offset.top - e.pageY\n\t\t\t};\n\t\t};\n\n\t\tconst dragFocalPoint = e => {\n\t\t\te.preventDefault();\n\n\t\t\tif (isDown) {\n\t\t\t\tconst focalPointPosition = {\n\t\t\t\t\tx: e.pageX + focalPointOffset.x,\n\t\t\t\t\ty: e.pageY + focalPointOffset.y\n\t\t\t\t};\n\t\t\t\tconsole.log(focalPointOffset, focalPointPosition);\n\t\t\t\tconst focalPoint = calculateFocalPoint(focalPointPosition);\n\t\t\t\tsetFocalPoint(focalPoint.x, focalPoint.y);\n\t\t\t}\n\t\t};\n\n\t\tconst endDragFocalPoint = e => {\n\t\t\t$('body').removeClass('focal-point-dragging');\n\t\t\tisDown = false;\n\t\t};\n\n\t\t/**\n\t\t * Update Focus Interface\n\t\t */\n\t\tconst updateFocusInterface = image => {\n\t\t\timageDimensions = {\n\t\t\t\twidth: image.width(),\n\t\t\t\theight: image.height()\n\t\t\t};\n\n\t\t\t$imageFocalWrapper.css({\n\t\t\t\twidth: `${imageDimensions.width}px`,\n\t\t\t\theight: `${imageDimensions.height}px`\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Init Focus Interface\n\t\t */\n\t\tconst initFocusInterface = attachment => {\n\t\t\t// Set focal point\n\t\t\tconst focalPoint = getFocalPoint(attachment);\n\t\t\tsetFocalPoint(focalPoint.x, focalPoint.y);\n\n\t\t\t// Add image/window listeners\n\t\t\t$image.on('load', e => updateFocusInterface($(e.currentTarget)));\n\t\t\t$(window).on('resize', () => updateFocusInterface($image));\n\n\t\t\t// Drag'n drop events\n\t\t\t$imageFocalPoint.on('mousedown', startDragFocalPoint);\n\t\t\t$imageFocalPoint.on('mousemove', dragFocalPoint);\n\t\t\t$imageFocalPoint.on('mouseup', endDragFocalPoint);\n\t\t};\n\n\t\t/**\n\t\t * Extend Attachment view\n\t\t */\n\t\tvar TwoColumn = wp.media.view.Attachment.Details.TwoColumn;\n\t\twp.media.view.Attachment.Details.TwoColumn = TwoColumn.extend({\n\t\t\tinitialize: function() {\n\t\t\t\t// Always make sure that our content is up to date.\n\t\t\t\tthis.model.on('change:compat', this.change, this);\n\t\t\t},\n\t\t\trender: function() {\n\t\t\t\t// Ensure that the main view is rendered.\n\t\t\t\twp.media.view.Attachment.prototype.render.apply(this, arguments);\n\t\t\t\t// Init focal point for images\n\t\t\t\tconst { type } = this.model.attributes;\n\t\t\t\tif (type === 'image') {\n\t\t\t\t\tinitTemplates(this.$el);\n\t\t\t\t\tinitFocusInterface(this.model);\n\t\t\t\t}\n\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tchange: function() {\n\t\t\t\t// Re-init focal point for images\n\t\t\t\tconst { type } = this.model.attributes;\n\t\t\t\tif (type === 'image') {\n\t\t\t\t\tconst focalPoint = getFocalPoint(this.model);\n\t\t\t\t\tsetFocalPoint(focalPoint.x, focalPoint.y);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n})(jQuery);\n"],"sourceRoot":""}